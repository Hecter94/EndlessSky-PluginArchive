# Copyright (c) 2021 by Michael Arsollon
# derived from original game at https://github.com/endless-sky/endless-sky
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.  See the GNU General Public License for more details.



mission "SB-Labs Vindicator 1"
	landing
	name "Meeting on Rust"
	description "You've been invited to <destination> to test a new ship."
	source
		government "Free Worlds"
		not attributes "uninhabited"
	destination "Rust"
	to offer
		has "Sheragi Archaeology: Epilogue: done"
		not "Oathbreaker Liberator 1: offered"
		or
			not "Oathbreaker Siege 1: offered"
			has "Oathbreaker Thermopylae: done"
	on offer
		dialog
			`You receive a message from Barmy Edwards on Rust: "Hello Captain <first> <last>. I just finished outfitting a new prototype ship for Southbound Shipyards. Would you be interested in helping to test it out?"`
	on complete
		dialog
			`Head for the shipyard when you are ready to meet Barmy Edwards and test the new ship he mentioned.`

mission "SB-Labs Vindicator 2"
	name "Vindicator Combat Testing"
	description "Test the combat capabilities of the new Liberator ship. Do not destroy or capture it. Land on <planet> when done."
	source "Rust"
	to offer
		has "SB-Labs Vindicator 1: done"
	on offer
		conversation
			`You find Barmy Edwards resting on a bench outside one of Kraz Cybernetics hangar bays. He looks worn out.`
			`"Hi <first>. This new ship was a beast to work on. I can already tell that it'll require more crew than they were expecting just to handle weapon maintenance." He stands up and stretches. "Well, since you're here, I guess it's time to see what it can do. As usual, we just want you to disable the Liberator, not destroy it. Understood?"`
			choice
				`	"Of course. So, what kind of ship is it?"`
				`	"Of course. Is it in this hangar?"`
			`	He smirks. "I don't want to spoil the surprise. We can talk about it once the test is over and we're back on the ground. Let's go!"`
				launch

	on enter
		dialog `The ship you are supposed to be fighting resembles a Dreadnought. But as you approach you can see that there are some definite design differences, notably the large cannon that is now powering up...`

	npc save disable
		personality disables staying heroic
		government "Test Dummy"
		ship "Vindicator (Test)" "SB-Labs Vindicator"

	on fail
		dialog `The prototype Vindicator has been destroyed. You receive an angry message from Barmy Edwards who fines you <payment> and warns that your actions may have consequences for the future safety of the Free Worlds.`
		"reputation: Free Worlds" -= 10
		payment -14000000
	on visit
		dialog `You've landed on <planet>, but you have not disabled the <npc> yet. Disable it before returning.`

ship "Liberator" "Vindicator (Test)"
	"display name" "Vindicator"
	add attributes
		"self destruct" 1
	description "The Vindicator is a new warship that was originally designed by Southbound Shipyards to replace the Skein. Rumor has it that the project scope shifted focus during development when a ship of alien origin was discovered at the edges of the Rim. As a result, the planned fighter bays were scrapped in favor of the concentrated fire mount. This design crams all of the ship's gun ports into a single central location, allowing multiple smaller guns to emulate the effect of having a single larger one. This negatively impacts the ship's cooling efficiency and increases the amount of work maintenance crews have to put in for guns not mounted on the edge of the cluster."

mission "SB-Labs Vindicator 3"
	landing
	name "Escort Vindicator"
	description "Escort the SB-Labs Vindicator to <destination>."
	source "Rust"
	destination "Zug"
	to offer
		has "SB-Labs Vindicator 2: done"
	on offer
		conversation
			scene "ship/liberator"
			`You meet Barmy Edward overseeing repairs at the hangar. The Vindicator towers over you. What looked like a massive cannon from a distance is, in actuality, a cluster of what appear to be several modified plasma cannons crammed together into a single firing module.`
			`	"It's your fault, you know." Barmy notices you eyeing the cannons. "From what I've been told, the entire forward section was originally supposed to be a fighter bay. But then you discovered that alien ship out past the edges of The Rim. Of course, word got out about the alien ship with the giant super gun mounted on it. After that, the Southbound Shipyard engineers became obsessed with putting together this monstrosity. They couldn't replicate the spinal mount of your Emerald Sword, so they improvised this concentrated firing mount instead."`
			label questions
			choice
				`	"What if one of the guns needs to be replaced?"`
				`	"Aren't there issues with heat?"`
					goto heat
				`	"When can I buy one?"`
					goto end
			
			scene scene/loc6
			`	"As I mentioned before, the maintenance on these weapons requires extra effort. Any gun not on the edge of the firing cluster can't be reached without first removing the other guns surrounding it. The Southbound Shipyards team thought they could get away with the same crew size as a Dreadnought. I'm recommending they increase that by about ten percent."`
				goto questions
			label heat
			scene scene/engine2
			`	"Oh, definitely. That's to be expected from cramming so many guns together in an a tightly enclosed space. Remember how I said that there was supposed to be a fighter bay where the concentrated firing mount is located? That giant cage surrounding the entrance was put there to extend the ship's shields around that area for the purpose of giving fighters additional cover during take off and landing. As you can see, they've bolted the cage to the firing cluster to try using it as a heat sink. It's not very effective..."`
				goto questions
			label end
			`	"Well, Southbound Shipyards hasn't even approved this design for mass production. My contact over there tells me that there's been some pushback since the original request was for a carrier, not a destroyer. They're hoping to use the results of this test to convince upper management to make an approval."`
			`One of the technicians hands Barmy a status report. After taking a look through it, Barmy says, "We're supposed to bring the ship back to <destination> as soon as repairs are done. Want to come along? We could use the escort."`
			choice
				`	(Accept.)`
					accept
				`	(Decline.)`
					decline

	npc
		government "Pirate"
		personality waiting harvests plunders nemesis
		system
			distance 1 2
		fleet "Small Southern Pirates"
	npc
		government "Pirate"
		personality waiting plunders nemesis
		system destination
		fleet "Small Southern Pirates"
	npc
		government "Pirate"
		personality entering plunders nemesis
		system destination
		fleet "Small Southern Pirates"
	npc
		government "Pirate"
		personality waiting staying plunders nemesis
		system destination
		fleet "Large Southern Pirates"

	npc accompany save
		government "Merchant"
		personality launching escort timid
		ship "Vindicator (Test)" "SB-Labs Vindicator"

	on visit
		dialog phrase "generic arrived-without-npc dialog"

mission "SB-Labs Vindicator 4"
	landing
	name "Return to <planet>"
	description "Oathbreakers have started a siege in the <system> system. Escape the siege, then return Barmy Edwards to <destination>."
	source "Zug"
	destination "Rust"
	to offer
		has "SB-Labs Vindicator 3: done"
	on offer
		log "Minor People" "Ricardo Astillero" `An engineer who works at Southbound Shipyards R&D.`
		conversation
			`As you disembark, you see Barmy talking to a man wearing a Southbound Shipyards engineering uniform.`
			`	Barmy waves you over. "Captain <last>, this is Ricardo Astillero from Southbound Shipyards R&D. He was just telling me the bad news."`
			`	"Wait, THE Captain <last>? The war hero?" Ricardo expresses his surprise.`
			choice
				`	"The one and only. So what's this bad news?"`
				`	"Nevermind that. What's this about bad news?"`
			
			`	"Upper management has decided to cancel the Vindicator project. They aren't even interested in seeing Barmy's test results."`
			`	"If that's true, then I'm guessing they plan on scrapping the ship?" asks Barmy.`
			`	"They are. But maybe Captain <last> can help."`
			choice
				`	"What do you mean?"`
			
			`	Ricardo has a grim look on his face. "Take the ship and leave. I'll tell them I tricked you into taking it for more testing. Please, we worked so hard on this..."`
			`	Barmy turns to you. "Even so, there might still be some repurcussions to your reputation. It's your choice, captain."`
			choice
				`	"Alright, it's a big risk, but I'll take it."`
					goto liberator
				`	"Sorry, no. I'm not willing to take this much risk for someone I just met."`
					goto risk

			label risk
			`	"I understand. Sorry for asking something so foolish." Ricardo looks dejected. "Excuse me. I have some things I need to do."`
			`	"I think I'll stay here for a while." Barmy says bitterly. "I probably can't do much to change their minds, but I'd still like to try."`
				decline

			label liberator
			`	"Thank you, captain!" Ricardo's eyes fill with hope. "You'd better get going. The sooner you get the Vindicator away from here, the better."`
			`	"I'd better come with you." Barmy says. "There might be some difficult questions to answer if I stick around. Besides, I need a lift home."`
				launch

	on accept
		give ship "Vindicator" "SB-Labs Vindicator"
		event "Pirate Glaze Reinforcements" 2

	on enter
		conversation
			scene "scene/scene-navyfleet"
			`A squad of Militia ships are launching from the planet. But they're not after you. Instead, they're targetting a large pirate fleet that just entered the system! It looks like the pirates are starting a siege. Time for the Vindicator to prove its worth!`
				accept

	on enter
		dialog `Some pirate ships seem to be following you. They must be planning to capture the Vindicator. You can either destroy them or try to shake off their pursuit!`
		
	npc
		government "Militia"
		personality entering staying uninterested
		fleet "Small Militia" 2
	npc 
		government "Pirate"
		personality entering staying uninterested
		fleet "Marauder fleet X"
		fleet "Marauder fleet VI"
		fleet "Marauder fleet V"
		fleet "Marauder fleet IV"
		
	npc evade
		government "Pirate"
		personality entering heroic plunders
		fleet "Marauder fleet VI"

	npc evade
		government "Pirate"
		personality waiting heroic plunders
		system
			distance 1
		fleet "Marauder fleet V"

	npc evade
		government "Pirate"
		personality waiting heroic plunders
		system
			distance 3
		fleet "Marauder fleet IV"
	npc evade
		government "Pirate"
		personality waiting heroic plunders
		system
			distance 7
		fleet "Marauder fleet VI"
	npc
		to spawn
			has "event: Pirate Glaze Reinforcements"
		government "Pirate"
		personality entering staying uninterested
		system "Zubeneschamali"
		fleet "Marauder Parade" 4

	on complete
		"reputation: Free Worlds" ++
		payment 100000
		log `After a series of adventures, I am now the lawful owner of Southbound Shipyards prototype Vindicator heavy warship. While the concentrated firing mount is an interesting concept, I hope to one day find a gun that truly diplays the potential of this ship.` 
		conversation
			`Barmy Edwards thanks you for safely returning him home. You receive a few messages when you land. The timing of the pirate attack couldn't have been more fortunate. Ricardo managed to convince everyone that you had taken the Vindicator in order to distract the pirates. Luring away a significant portion of their fleet may have turned the tide of battle in favor of the defenders. Zug is even rewarding you with <payment> for your contribution to the planetary defense. Southbound Shipyards has decided to let you keep the Vindicator to avoid any public backlash for antagonizing the new hero of Zug.`

event "Pirate Glaze Reinforcements"



mission "Oathbreaker Liberator 1"
	landing
	name "Meeting on Rust"
	description "You've been invited to <destination> to test a new ship."
	source
		government "Free Worlds"
		not attributes "uninhabited"
	destination "Rust"
	to offer
		has "Sheragi Archaeology: Epilogue: done"
		has "Oathbreaker Siege 1: done"
		not "Oathbreaker Thermopylae: done"
		not "SB-Labs Vindicator 1: offered"
	on offer
		dialog
			`You receive a message from Barmy Edwards on Rust: "Hello Captain <first> <last>. I just finished outfitting a new prototype ship for Southbound Shipyards. Would you be interested in helping to test it out?"`
	on complete
		dialog
			`Head for the shipyard when you are ready to meet Barmy Edwards and test the new ship he mentioned.`

mission "Oathbreaker Liberator 2"
	name "Liberator Combat Testing"
	description "Test the combat capabilities of the new Liberator ship. Do not destroy or capture it. Land on <planet> when done."
	source "Rust"
	to offer
		has "Oathbreaker Liberator 1: done"
	on offer
		conversation
			`You find Barmy Edwards resting on a bench outside one of Kraz Cybernetics hangar bays. He looks worn out.`
			`"Hi <first>. This new ship was a beast to work on. I can already tell that it'll require more crew than they were expecting just to handle weapon maintenance." He stands up and stretches. "Well, since you're here, I guess it's time to see what it can do. As usual, we just want you to disable the Liberator, not destroy it. Understood?"`
			choice
				`	"Of course. So, what kind of ship is it?"`
				`	"Of course. Is it in this hangar?"`
			`	He smirks. "I don't want to spoil the surprise. We can talk about it once the test is over and we're back on the ground. Let's go!"`
				launch

	on enter
		dialog `The ship you are supposed to be fighting resembles a Dreadnought. But as you approach you can see that there are some definite design differences, notably the large cannon that is now powering up...`

	npc save disable
		personality disables staying heroic
		government "Test Dummy"
		ship "Liberator (Test)" "SB-Labs Liberator"

	on fail
		dialog `The prototype Liberator has been destroyed. You receive an angry message from Barmy Edwards who fines you <payment> and warns that your actions may have consequences for the future safety of the Free Worlds.`
		"reputation: Free Worlds" -= 10
		payment -14000000
	on visit
		dialog `You've landed on <planet>, but you have not disabled the <npc> yet. Disable it before returning.`
	
ship "Liberator" "Liberator (Test)"
	add attributes
		"self destruct" 1

mission "Oathbreaker Liberator 3"
	landing
	name "Escort Liberator"
	description "Escort the SB-Labs Liberator to <destination>."
	source "Rust"
	destination "Zug"
	to offer
		has "Oathbreaker Liberator 2: done"
	on offer
		conversation
			scene "ship/liberator"
			`You meet Barmy Edward overseeing repairs at the hangar. The Liberator towers over you. What looked like a massive cannon from a distance is, in actuality, a cluster of what appear to be several modified plasma cannons crammed together into a single firing module.`
			`	"It's your fault, you know." Barmy notices you eyeing the cannons. "From what I've been told, the entire forward section was originally supposed to be a fighter bay. But then you discovered that alien ship out past the edges of The Rim. Of course, word got out about the alien ship with the giant super gun mounted on it. After that, the Southbound Shipyard engineers became obsessed with putting together this monstrosity. They couldn't replicate the spinal mount of your Emerald Sword, so they improvised this concentrated firing mount instead."`
			label questions
			choice
				`	"What if one of the guns needs to be replaced?"`
				`	"Aren't there issues with heat?"`
					goto heat
				`	"When can I buy one?"`
					goto end
			
			scene scene/loc6
			`	"As I mentioned before, the maintenance on these weapons requires extra effort. Any gun not on the edge of the firing cluster can't be reached without first removing the other guns surrounding it. The Southbound Shipyards team thought they could get away with the same crew size as a Dreadnought. I'm recommending they increase that by about ten percent."`
				goto questions
			label heat
			scene scene/engine2
			`	"Oh, definitely. That's to be expected from cramming so many guns together in an a tightly enclosed space. Remember how I said that there was supposed to be a fighter bay where the concentrated firing mount is located? That giant cage surrounding the entrance was put there to extend the ship's shields around that area for the purpose of giving fighters additional cover during take off and landing. As you can see, they've bolted the cage to the firing cluster to try using it as a heat sink. It's not very effective..."`
				goto questions
			label end
			`	"Well, Southbound Shipyards hasn't even approved this design for mass production. My contact over there tells me that there's been some pushback since the original request was for a carrier, not a destroyer. They're hoping to use the results of this test to convince upper management to make an approval."`
			`One of the technicians hands Barmy a status report. After taking a look through it, Barmy says, "We're supposed to bring the ship back to <destination> as soon as repairs are done. Want to come along? We could use the escort."`
			choice
				`	(Accept.)`
					accept
				`	(Decline.)`
					decline

	npc
		government "Pirate"
		personality waiting harvests plunders nemesis
		system
			distance 1 2
		fleet "Small Southern Pirates"
	npc
		government "Pirate"
		personality waiting plunders nemesis
		system destination
		fleet "Small Southern Pirates"
	npc
		government "Pirate"
		personality entering plunders nemesis
		system destination
		fleet "Small Southern Pirates"
	npc
		government "Pirate"
		personality waiting staying plunders nemesis
		system destination
		fleet "Large Southern Pirates"

	npc accompany save
		government "Merchant"
		personality launching escort timid
		ship "Liberator (Test)" "SB-Labs Liberator"

	on visit
		dialog phrase "generic arrived-without-npc dialog"

mission "Oathbreaker Liberator 4"
	landing
	name "Return to <planet>"
	description "Oathbreakers have started a siege in the <system> system. Escape the siege, then return Barmy Edwards to <destination>."
	source "Zug"
	destination "Rust"
	to offer
		has "Oathbreaker Liberator 3: done"
	on offer
		log "People" "Ricardo Astillero" `An engineer who works at Southbound Shipyards R&D.`
		conversation
			`As you disembark, you see Barmy talking to a man wearing a Southbound Shipyards engineering uniform.`
			`	Barmy waves you over. "Captain <last>, this is Ricardo Astillero from Southbound Shipyards R&D. He was just telling me the bad news.`
			`	"Wait, THE Captain <last>? The war hero?" Ricardo expresses his surprise.`
			choice
				`	"The one and only. So what's this bad news?"`
				`	"Nevermind that. What's this about bad news?"`
			
			`	"Upper management has decided to cancel the Liberator project. They aren't even interested in seeing Barmy's test results."`
			`	"If that's true, then I'm guessing they plan on scrapping the ship?" asks Barmy.`
			`	"They are. But maybe Captain <last> can help."`
			choice
				`	"What do you mean?"`
			
			`	Ricardo has a grim look on his face. "Take the ship and leave. I'll tell them I tricked you into taking it for more testing. Please, we worked so hard on this..."`
			`	Barmy turns to you. "Even so, there might still be some repurcussions to your reputation. It's your choice, captain."`
			choice
				`	"Alright, it's a big risk, but I'll take it."`
					goto liberator
				`	"Sorry, no. I'm not willing to take this much risk for someone I just met."`
					goto risk

			label risk
			`	"I understand. Sorry for asking something so foolish." Ricardo looks dejected. "Excuse me. I have some things I need to do."`
			`	"I think I'll stay here for a while." Barmy says bitterly. "I probably can't do much to change their minds, but I'd still like to try."`
				decline

			label liberator
			`	"Thank you, captain!" Ricardo's eyes fill with hope. "You'd better get going. The sooner you get the Liberator away from here, the better."`
			`	"I'd better come with you." Barmy says. "There might be some difficult questions to answer if I stick around. Besides, I need a lift home."`
				launch

	on accept
		give ship "Liberator" "SB-Labs Liberator"
		event "Oathbreaker Glaze Reinforcements" 2

	on enter
		conversation
			scene "scene/scene-navyfleet"
			`A squad of Militia ships are launching from the planet. But they're not after you. Instead, they're targetting a large Oathbreaker fleet that just entered the system! It looks like the Oathbreakers are starting a siege. Time for the Liberator to prove its worth!`
				accept

	on enter
		dialog `Some Oathbreaker ships seem to be following you. They must have received orders to capture the Liberator. You can either destroy them or try to shake off their pursuit!`
		
	npc
		government "Militia"
		personality entering staying uninterested
		fleet "Small Militia" 2
	npc 
		government "Oathbreaker"
		personality entering staying uninterested
		fleet "Large Oathbreaker"
		fleet "Small Oathbreaker" 3
	npc evade
		government "Oathbreaker"
		personality entering heroic plunders
		fleet "Small Oathbreaker"
	npc evade
		government "Oathbreaker"
		personality waiting heroic plunders
		system
			distance 1
		fleet "Small Oathbreaker"
	npc evade
		government "Oathbreaker"
		personality waiting heroic plunders
		system
			distance 3
		fleet "Small Oathbreaker"
	npc evade
		government "Oathbreaker"
		personality waiting heroic plunders
		system
			distance 7
		fleet "Small Oathbreaker"
	npc
		to spawn
			has "event: Oathbreaker Glaze Reinforcements"
		government "Oathbreaker"
		personality entering staying uninterested
		system "Zubeneschamali"
		fleet "Large Oathbreaker" 4
		fleet "Small Oathbreaker" 8

	on complete
		"reputation: Free Worlds" ++
		payment 100000
		log `After a series of adventures, I am now the lawful owner of Southbound Shipyards prototype Liberator heavy warship. While the concentrated firing mount is an interesting concept, I hope to one day find a gun that truly diplays the potential of this ship.` 
		conversation
			`Barmy Edwards thanks you for safely returning him home. You receive a few messages when you land. The timing of the Oathbreaker attack couldn't have been more fortunate. Ricardo managed to convince everyone that you had taken the Liberator in order to distract the Oathbreakers. Luring away a significant portion of their fleet may have turned the tide of battle in favor of the defenders. Zug is even rewarding you with <payment> for your contribution to the planetary defense. Southbound Shipyards has decided to let you keep the Liberator to avoid any public backlash for antagonizing the new hero of Zug.`

event "Oathbreaker Glaze Reinforcements"



mission "Plasma Cluster Cannons"
	invisible
	minor
	source Rust
	to offer
		or
			has "SB-Labs Vindicator 4: done"
			has "Oathbreaker Liberator 4: done"
		"credits" > 2660000
		random < 70
	on offer
		require "Plasma Cluster Cannon" 0
		conversation
			scene "outfit/plasma cluster cannon"
			branch "liberator"
				has "Oathbreaker Liberator 4: done"
			`You bump into Barmy Edwards at the spaceport convenience store. "Oh, <first>! I forgot to mention we have a spare set of Plasma Charge Cannons set aside. Since production of the Vindicator was cancelled, Kraz has no plans to add them to our regular inventory. So they're just gathering dust. Would you be interested in buying them? They're the same price as regular Plasma Cannons, so the full set comes to 1,330,000 credits."`
			choice
				`	(Buy them.)`
					accept
				`	(Don't buy them.)`
					decline
			label "liberator"
			`You bump into Barmy Edwards at the spaceport convenience store. "Oh, <first>! I forgot to mention we have a spare set of Plasma Charge Cannons set aside. Since production of the Liberator was cancelled, Kraz has no plans to add them to our regular inventory. So they're just gathering dust. Would you be interested in buying them? They're the same price as regular Plasma Cannons, so the full set comes to 1,330,000 credits."`
			choice
				`	(Buy them.)`
					accept
				`	(Don't buy them.)`
					decline
	on accept
		payment 1330000
		outfit "Plasma Cluster Cannon" 7
		fail
		
mission "Plasma Cluster Cannons 2"
	invisible
	source
		government "Pirate"
		attributes "core" "core pirate"
	to offer
		or
			has "SB-Labs Vindicator 4: done"
			has "Oathbreaker Liberator 4: done"
	on offer
		require "Plasma Cluster Cannon"
		conversation
			scene "outfit/plasma cluster cannon"
			`After returning to your ship, you notice one of your Plasma Charge Cannons is missing! The thieves managed to bypass your security systems.`
				decline
	on decline
		log `One of my Plasma Charge Cannons was stolen. The thieves managed the bypass your security systems.`
		outfit "Plasma Cluster Cannon" -1
		event "Plasma Cluster Cannon pirate development" 30

event "Plasma Cluster Cannon pirate development"

mission "Plasma Cluster Cannons 3"
	name "Firebrand"
	description "A heavy warship named the <npc> and its fleet is attacking Merchants near <destination>. Witnesses claim they are armed with what may be Plasma Charge Cannons. Destroy the fleet for <payment>."
	"apparent payment" 600000
	source
		government "Syndicate"
		attributes "core"
		attributes "frontier"
	to offer
		has "event: Plasma Cluster Cannon pirate development"
	on offer
		event "Plasma Cluster Cannons pirate core"
		set "plasma cluster cannon new tortuga patched"
		conversation
			scene "outfit/plasma cluster cannon"
			`You overhear some bounty hunters mention that the <npc> is a vicious warship. It seems the ship is armed with Plasma Charge Cannons. A bounty is offering a reward of <payment> for destroying it and its fleet.`
			choice
				`	(Pursue the <npc>.)`
					accept
				`	(Let it go.)`
					decline
	npc kill
		government "Bounty"
		system
			distance 1 2
		personality target waiting staying plunders harvests
		ship "Marauder Vanguard (Plasma Cluster)" "Firebrand"
		ship "Marauder Vanguard (Plasma Cluster)" "Fire Staff"
		ship "Marauder Vanguard (Plasma Cluster)" "Fire Spitter"
		dialog `You've defeated the <npc> and it's fleet. Return to <destination> for payment.`
		on kill
			payment 600000
			log `Pirates must have used the Plasma Charge Cannon that was stolen from you to develop their own.`
			conversation
				scene "outfit/plasma cluster cannon"
				`The government of <planet> rewards you with <payment> for eliminating the <npc> and its fleet. Unfortunately, those ships were armed with Plasma Charge Cannons. Pirates must have used the one that was stolen from you to develop their own.`
			fail

outfitter "Plasma Cluster Cannon"
	"Plasma Cluster Cannon"
			
event "Plasma Cluster Cannons pirate core"
	planet "New Tortuga"
		add outfitter "Plasma Cluster Cannon"
	fleet "Large Core Pirates"
		add variant 1
			"Vanguard (Plasma Cluster)"

mission "Plasma Cluster Cannon New Tortuga Patch"
	landing
	invisible
	to offer
		has "event: Plasma Cluster Cannons pirate core"
		not "plasma cluster cannon new tortuga patched"
	on offer
		event "plasma cluster cannon new tortuga patch"
		fail

event "plasma cluster cannon new tortuga patch"
	planet "New Tortuga"
		add outfitter "Plasma Cluster Cannon"
	planet "Buccaneer Bay"
		remove outfitter "Plasma Cluster Cannon"
	planet Covert
		remove outfitter "Plasma Cluster Cannon"
	planet "Deadman's Cove"
		remove outfitter "Plasma Cluster Cannon"
	planet Stormhold
		remove outfitter "Plasma Cluster Cannon"



mission "Plexus Prototype 1"
	minor
	name "Investigate Zug"
	description "Something happened near <destination>, but Southbound Shipyards is keeping it a secret."
	source
		government "Free Worlds"
		attributes "spaceport"
		not attributes "station" "uninhabited"
	destination "Zug"
	to offer
		has "event: Oathbreaker diminish 2"
		or
			has "SB-Labs Vindicator 4: done"
			has "Oathbreaker Liberator 4: done"
		random < 70
	on offer
		conversation
			scene "thumbnail/dreadnought"
			`A Dreadnought is getting ready to take off. As you watch it leave, you remember the first time you saw one long ago. As you reflect on events that have happened since then, someone calls out to you, interrupting your thoughts.`

			branch "Liberator"
				has "Oathbreaker Liberator 4: done"

			`	"Captain <last>!" It's Ricardo Astillero, the engineer from Southbound Shipyards R&D who asked you to steal the Vindicator. "I'd heard the <ship> arrived and decided I should contact you. I thought perhaps you might be interested in helping us test the Plexus, the original design for the Vindicator. Management is dead set on getting it into production as soon as possible."`
				goto Plexus

			label Liberator
			`	"Captain <last>!" It's Ricardo Astillero, the engineer from Southbound Shipyards R&D who asked you to steal the Liberator. "I'd heard the <ship> arrived and decided I should contact you. I thought perhaps you might be interested in helping us test the Plexus, the original design for the Liberator. Management is dead set on getting it into production as soon as possible."`

			label Plexus
			`	Before you can respond, Ricardo's communicator beeps loudly. "Sorry, I have to take this call." Ricardo takes the call. But after a minute of listening, he reacts in shock. "What! The Plexus? When did they find out? Mmmhmm. Near Zug? Alright, I'll be there."`
			`	After putting the communicator away, Ricardo turns to you, "I have to get back to the office. Unfortunately, we won't be able to test the Plexus any time soon."`
			choice
				`	"Did something happen to the Plexus?"`
				`	"What's near Zug?"`
			`	"I'm sorry," Ricardo apologizes, "but I was told not to discuss that. Management already grilled me for what happened the last time we met."`
			`	After parting ways with Ricardo, you wonder if you should investigate Zug.`
				accept
	npc
		government "Free Worlds"
		personality launching fleeing
		ship "Dreadnought" "F.S. Eucalyptus"

	on complete
		conversation
			`After asking around Zug, you've learned that a pirate ship that resembles a Dreadnought attacked a few days ago then fled. Perhaps pirates stole the Plexus prototype. Unfortunately, no one here knows where they are now.`

mission "Plexus Prototype 2"
	landing
	name "Cat's Cradle"
	description "The stolen Plexus, now possibly outfitted with a Jump Drive, left <origin> to setup a pirate base somewhere along the rim..."
	source "Rum Cellar"
	destination "Valley of the Damned"
	to offer
		has "Plexus Prototype 1: done"
	on offer
		conversation
			scene "outfit/jump drive"
			`Some rogues at the spaceport bar mention that the Cat's Cradle, supposedly a modified Dreadnought, has a way of Jumping like the Quarg do. Some of their crew members were bragging about finding a new planet somewhere along the rim to set up as a pirate base. This is the best clue you've found to a lead on the stolen Plexus.`
				accept
	on enter Zubenelhakrabi
		conversation
			scene "thumbnail/raider"
			`You find some unexpected company when you arrive. They don't seem friendly.`
	npc
		government "Alpha"
		system Zubenelhakrabi
		personality target waiting staying vindictive
		fleet
			names "pirate"
			cargo 0
			variant
				"'olofez" 2
				"Finch" 4
				"Barb" 4
				"Dagger" 4
	npc kill
		government "Alpha"
		system Zubenelhakrabi
		personality target waiting staying vindictive opportunistic
		ship "Korath Raider (Plexus)" "Dark Citadel"
		dialog `You've neutralized the Raider, but some fighters fled to the planet below...`


ship "Palavret" "Korath Raider (Plexus)"
	sprite "ship/raider"
	add attributes
		"outfit space" 56
		"weapon capacity" 55
	outfits
		"Banisher Grav-Turret" 5
		"Warder Anti-Missile"
		"Torpedo Launcher" 2
		"Torpedo" 60
		
		"Triple Plasma Core"
		"Systems Core (Medium)" 2
		"Large Heat Shunt" 2
		"Small Heat Shunt" 2
		"Fuel Processor"
		"Thermal Repeater Rifle" 196
		"Outfits Expansion"
		
		"Thruster (Planetary Class)"
		"Steering (Planetary Class)"

	turret "Banisher Grav-Turret"
	turret "Banisher Grav-Turret"
	turret "Banisher Grav-Turret"
	turret "Banisher Grav-Turret"
	turret "Warder Anti-Missile"
	turret "Banisher Grav-Turret"

mission "Plexus Prototype 3"
	landing
	name "Cat's Cradle"
	description "Go to <destination> after destroying the <npc>. The Free Worlds needs to know that Alphas have set up a base at Zubenelhakrabi."
	source "Valley of the Damned"
	destination "Bourne"
	to offer
		has "Plexus Prototype 2: done"
	on offer
		conversation
			`You're not certain where those fighters fled. Storm clouds are covering half the planet's surface and Alphas can probably tolerate this world's harsh environment better than you can. Suddenly your ship is being hailed.`
			`	"You'll -ay for wh-t -ou've done!" The message is somewhat garbled by electro magnetic interference from the storms and you can't tell if it originated from the surface or orbit.`
				accept
	on enter
		conversation
			scene "ship/plexus"
			`The <npc> has arrived and it brought some backup!`
	npc
		government "Alpha"
		system Zubenelhakrabi
		personality target waiting staying vindictive
		fleet
			names "pirate"
			cargo 0
			variant
				"Roost (Korath)"
				"Aerie (Korath)"
				"Nest (Korath)"
				"'olofez" 4
				"Finch" 6
				"Barb" 6
				"Dagger" 6
	npc kill
		government "Alpha"
		system Zubenelhakrabi
		personality target waiting staying vindictive opportunistic
		ship "Plexus (Korath)" "Cat's Cradle"
		dialog `You've destroyed the <npc>. Report to <destination> to inform the Free Worlds about the Alphas on <origin>.`

mission "Plexus Prototype 4"
	landing
	name "Jump Drives"
	description "Bring a Jump Drive to the Free Worlds to help boost defense against threats from beyond human space."
	source "Bourne"
	to offer
		has "Plexus Prototype 3: done"
	on offer
		conversation
			scene "outfit/jump drive"
			`You contact Alondo and inform him of the Alpha activity in Zubenelhakrabi. "It will be hard to deal with that unless we can acquire more Jump Drives. Do you suppose you could help with that?`
			choice
				`	"I'll see what I can do."`
					goto support
				`	"No! All the Jump Drives are belong to me!"`
			`	Alondo looks at you incredulously. Forget it. I'll find someone else.`
				decline
			
			label support

			scene "scene/scene-liberator"
			
			branch "liberator"
				has "Oathbreaker Liberator 4: done"

			`	"I'm confident you'll figure something out. Before you leave, tell me what you think of the Plexus. Is it a better ship than the Vindicator? I understand there's some internal dispute at Southbound Shipyards over which model to dedicate resources on. A large order from the Free Worlds could finally tip the scale in one direction or the other. Your experience with both ships makes your opinion invaluable. So how about it <first>? Which ship do you think Southbound Shipyards should produce?"`
			choice
				`	"The Plexis is the better ship."`
					goto chooseplexus
				`	"The Vindicator is the better ship."`
					goto choosevindicator
			
			label liberator

			`	"I'm confident you'll figure something out. Before you leave, tell me what you think of the Plexus. Is it a better ship than the Liberator? I understand there's some internal dispute at Southbound Shipyards over which model to dedicate resources on. A large order from the Free Worlds could finally tip the scale in one direction or the other. Your experience with both ships makes your opinion invaluable. So how about it <first>? Which ship do you think Southbound Shipyards should produce?"`
			choice
				`	"The Plexus is the better ship."`
					goto chooseplexus
				`	"The Liberator is the better ship."`
					goto chooseliberator

			label chooseplexus

			scene "ship/plexus"
			action
				set "Dreadnought Evolution: chose Plexus"
			`	"The Plexus... I suppose a sturdier carrier would help bolster our fleets. Thanks <first>, I'll try my best to convince the senate to go along with that." Alondo bids you farewell as you exit his office.`
				accept
			
			label choosevindicator

			scene "ship/liberator"
			action
				set "Dreadnought Evolution: chose Vindicator"
			`	"The Vindicator... I suppose a stronger battleship would help bolster our fleets. Thanks <first>, I'll try my best to convince the senate to go along with that." Alondo bids you farewell as you exit his office.`
				accept
						
			label chooseliberator
			
			scene "ship/liberator"
			action
				set "Dreadnought Evolution: chose Liberator"
			`	"The Liberator... I suppose a stronger battleship would help bolster our fleets. Thanks <first>, I'll try my best to convince the senate to go along with that." Alondo bids you farewell as you exit his office.`
				accept
	on complete
		outfit "Jump Drive" -1
		"Plexus Jump Drives" ++
		payment 1000000
		conversation
			scene "outfit/jump drive"
			`You are directed to deliver the Jump Drive to a Free Worlds military base and are compensated with <payment>. You can register to make more deliveries on the job board.`

mission "Plasma Cluster Cannons: Rust"
	landing
	name "Weapon Delivery"
	description "Deliver a set of Plasma Charge Cannons to Southbound Shipyards on <destination>. Payment is <payment>."
	cargo "Plasma Charge Cannons" 175
	source Rust
	destination Zug
	to offer
		or
			has "event: Dreadnought Evolution - Vindicator"
			has "event: Dreadnought Evolution - Liberator"
	on offer
		conversation
			scene "outfit/plasma cluster cannon"

			branch "liberator"
				has "event: Dreadnought Evolution - Liberator"
			
			`You run into Barmy at the spaceport. "Hey <first>, it looks like Southbound Shipyards ended up making the Vindicator after all. The outfitter here began stocking Plasma Charge Cannons. We also just produced a fresh batch of them that need to get to <destination>. Would like to take on the delivery job? It pays <payment>."`
				goto end
			
			label liberator
			
			`You run into Barmy at the spaceport. "Hey <first>, it looks like Southbound Shipyards ended up making the Liberator after all. The outfitter here began stocking Plasma Charge Cannons. We also just produced a fresh batch of them that need to get to <destination>. Would like to take on the delivery job? It pays <payment>."`
			
			label end
			
			choice
				`	"Sure, I'll make the delivery."`
				`	"Sorry, I'm headed in a different direction."`
					goto refuse

			`	"Thanks <first>, I know they're in good hands! Remember to stop by the outfitter if you want to outfit your own ships with Plasma Charge Cannons." Barmy wishes you farewell.`
				accept
			
			label refuse
			`	"No worries. Remember to stop by the outfitter if you want to outfit your own ships with Plasma Charge Cannons." Barmy wishes you farewell.`
				decline

	npc evade
		government "Alpha"
		system destination
		personality heroic vindictive harvests
		ship "Dreadnought (Plasma Cluster)" "Gratuitous Violence"

	on complete
		payment 175000
		conversation
			scene "scene/scene-liberator"
			
			branch "liberator"
				has "event: Dreadnought Evolution - Liberator"
			
			`You deliver the Plasma Charge Cannons to Southbound Shipyards and are given your delivery fee of <payment>. The mechanics begin unloading and installing them on a Vindicator.`
				goto end
			
			label liberator

			`You deliver the Plasma Charge Cannons to Southbound Shipyards and are given your delivery fee of <payment>. The mechanics begin unloading and installing them on a Liberator.`
			
			label end
			
			`	"Seeing it without the guns loaded, it could be mistaken for the Plexus." Ricardo greets you. "I heard you stopped pirates from using the prototype Plexus to set up a base near Zug. Thanks for that." You both watch as the ship's appearance shifts with the installation of the cannons.`


mission "Plexus Jump Drives"
	job
	repeat
	name "Jump Drives"
	description "Bring a Jump Drive to the Free Worlds to help boost defense against threats from beyond human space."
	source "Bourne"
	to offer
		has "Plexus Prototype 4: done"
		random < 50
	on complete
		outfit "Jump Drive" -1
		"Plexus Jump Drives" ++
		payment 1000000
		conversation
			scene "outfit/jump drive"
			`You are directed to deliver the Jump Drive to a Free Worlds military base and are compensated with <payment>.`

mission "Plexus Alpha Raid"
	minor
	repeat
	name "Alien Raid"
	description "An alien ship is attacking <planet>! Join the planetary defense, then land on planet for a reward."
	source
		near Zubeneschamali 0 2
	to offer
		has "Plexus Prototype 3: done"
		random < 5
	on offer
		conversation
			`Suddenly you hear raised voices and shouting outside: "We are under attack! <planet> is under attack by alien raiders! We need every combat-worthy ship to join the defenses!" The authorities will probably pay you quite well if you assist them, but this could also be an easy way to get yourself killed.`
			choice
				`	(Stay here until the fight is over.)`
					decline
				`	(Join the defense fleet.)`
			`The local Militia are preparing to repel the alien attack. You join them, and take off together...`
				launch
	npc
		government "Militia"
		personality heroic
		fleet "Small Militia"
	npc kill
		government "Alpha"
		personality target waiting staying plunders harvests
		fleet
			names "pirate"
			cargo 3
			commodities "Food" "Industrial" "Medicine"
			variant 1
				"Korath Raider (Torpedo)"
				"'olofez" 2
			variant 1
				"Shield Beetle (Jump, Pulse)"
			variant 1
				"Pug Maboro"
		dialog `You've eliminated the raiders. Return to <planet> for a reward.`
	on complete
		payment 550000
		dialog `The government of <planet> pays you <payment> for helping to drive off the raiders.`



mission "Plexus Chose Plexus"
	landing
	invisible
	to offer
		has "Dreadnought Evolution: chose Plexus"
	on offer
		event "Dreadnought Evolution - Plexus" 180
		fail

mission "Plexus Chose Vindicator"
	landing
	invisible
	to offer
		has "Dreadnought Evolution: chose Vindicator"
	on offer
		event "Dreadnought Evolution - Vindicator" 180
		fail

mission "Plexus Chose Liberator"
	landing
	invisible
	to offer
		has "Dreadnought Evolution: chose Liberator"
	on offer
		event "Dreadnought Evolution - Liberator" 180
		fail

event "Dreadnought Evolution - Plexus"
	shipyard "Southbound Advanced"
		add "Plexus"
	fleet "Large Free Worlds"
		add variant 1
			"Plexus"
			"Finch" 4
		add variant 1
			"Plexus"
			"Finch (Flamethrower)"
	fleet "Large Militia"
		add variant 1
			"Plexus"
			"Finch" 4
		add variant 1
			"Plexus"
			"Finch (Flamethrower)"

event "Dreadnought Evolution - Vindicator"
	planet Rust
		add outfitter "Plasma Cluster Cannon"
	shipyard "Southbound Advanced"
		add "Vindicator"
	fleet "Large Free Worlds"
		add variant 1
			"Vindicator"
		add variant 1
			"Dreadnought (Plasma Cluster)"
	fleet "Large Militia"
		add variant 1
			"Vindicator"
		add variant 1
			"Dreadnought (Plasma Cluster)"

event "Dreadnought Evolution - Liberator"
	planet Rust
		add outfitter "Plasma Cluster Cannon"
	shipyard "Southbound Advanced"
		add "Liberator"
	fleet "Large Free Worlds"
		add variant 1
			"Liberator"
		add variant 1
			"Dreadnought (Plasma Cluster)"
	fleet "Large Militia"
		add variant 1
			"Liberator"
		add variant 1
			"Dreadnought (Plasma Cluster)"
