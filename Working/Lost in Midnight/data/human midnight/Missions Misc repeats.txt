# Copyright (c) 2021 by Michael Arsollon
# derived from original game at https://github.com/endless-sky/endless-sky
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.  See the GNU General Public License for more details.



#########################
# missions that repeat
#########################


mission "Independent Refugee"
	name "Passenger to <planet>"
	repeat
	description "Help <fare> escape from <origin> to <destination>. Payment is <payment>."
	minor
	passengers 1
	to offer
		random < 5 - "rejected illegal jobs"
	source
		government "Pirate"
		not attributes uninhabited
	destination
		distance 0 5
		government "Independent" "Republic" "Free Worlds" "Syndicate" "Quarg" "Neutral"
	on offer
		dialog phrase "generic refugee offer"
	on accept
		"rejected illegal jobs" --
	on decline
		"rejected illegal jobs" ++
	on visit
		dialog phrase "generic passenger on visit"
	on complete
		"reputation: Independent" ++
		"getaway driver" ++
		payment
		payment 1000
		dialog phrase "generic refugee dropoff payment"



mission "Midnight Blaster Roulette 0 (Assist)"
	assisting
	minor
	name "Puppetmaster"
	description "Bring a Blaster Charger to <destination> to take the Puppetmaster's Challenge."
	to offer
		random < 70
	source
		government "Pirate" "Independent"
		not attributes "automaton"
	on offer
		payment 5000
		outfit "Blaster Charger" 1
		conversation
			scene "outfit/blaster charger"
			`When you repair the <origin>, the captain thanks you for your assistance and pays you <payment>. Before you leave, the captain also offers you a Blaster Charger.`
			choice
				`	"What's this for?"`
			scene "planet/lava0"
			`The captain says, "If you're feeling lucky, bring that to Bailey in the Citadelle system and take the Puppetmaster's challenge. If you can survive, you'll receive a special prize."`
				accept
	destination "Bailey"
	on complete
		dialog "Visit the spaceport to search for the Puppetmaster or sell the Blaster Charger to one of the locals."

mission "Midnight Blaster Roulette 0 (Assist) Patch"
	landing
	name "Puppetmaster"
	description "Bring a Blaster Charger to <destination> to take the Puppetmaster's Challenge."
	to offer
		has "Midnight Blaster Roulette 0 (Assist): declined"
	on offer
		clear "Midnight Blaster Roulette 0 (Assist): declined"
		set "Midnight Blaster Roulette 0 (Assist): done"
	destination "Bailey"
	on complete
		dialog "Visit the spaceport to search for the Puppetmaster or sell the Blaster Charger to one of the locals."

mission "Midnight Blaster Roulette 1"
	invisible
	source Bailey
	to offer
		has "Midnight Blaster Roulette 0 (Assist): done"
		has "outfit (flagship installed): Blaster Charger"
	on offer
		conversation
			scene "outfit/blaster charger"
			`You've been told that there is a special prize to be won by bringing a Blaster Charger to a person called the "Puppetmaster" and surviving some sort of challenge...`
			choice
				`	(Search for the Puppetmaster.)`
					goto search
				`	(Sell the Blaster Charger instead.)`
			action
				payment 5000
				outfit "Blaster Charger" -1
			scene "outfit/blaster charger"
			`	You decide to ignore the Puppetmaster's challenge and have no problem selling the Blaster Charger to one of the locals. You find a buyer willing to pay 5,000 credits for it, ten times what it's worth elsewhere.`
				decline
			label search
			branch coalition
				has "Coalition: First Contact: offered"
			scene "thumbnail/heliarch stalker"
			`	After asking around, you learn that the Puppetmaster's ship is currently parked at a landing pad at the edge of the spaceport. You arrive to find an exotic ship parked there. A terminal near the landing pad's entryway allows you to hail the ship.`
			choice
				`	(Use the terminal.)`
					goto puppetmaster
			label coalition
			scene "thumbnail/heliarch stalker"
			`	After asking around, you learn that the Puppetmaster's ship is currently parked at a landing pad at the edge of the spaceport. You arrive to find a ship parked there that appears to be from the Coalition. A terminal near the landing pad's entryway allows you to hail the ship.`
			choice
				`	(Use the terminal.)`
					goto puppetmaster
			label puppetmaster
			`	A mechanical voice answers. "Want what do you?"`
			choice
				`	"I'm here for the challenge."`
				`	"Are you from the Coalition?"`
					to display
						has "Coalition: First Contact: offered"
					goto fugitive
			scene "outfit/blaster charger"
			`	You hold up the Blaster Charger. The Puppetmaster responds, "Enter you may, but leave your weapons by the entrance you must."`
			choice
				`	"Forget it, I changed my mind."`
				`	"Alright, I can do that."`
					goto enter
			scene "outfit/attention"
			`	A strange hollow laughter comes from the terminal. "Coward! Lost you get."`
			choice
				`	"Alright, I'll play by your rules."`
				`	(Walk away. You want no part of this.)`
					decline
			label enter
			`	The entry hatch pops open and you walk in. An empty table is conveniently located nearby for you to place your weapons on.`
			choice
				`	(Abide by the Puppetmaster's rules.)`
					goto proceed
				`	("Forget" to place your basic sidearm on the table.)`
			`	When you try to walk farther in, a mechanical voice speaks from a loudspeaker. "A weapon you still have. The weapon you leave or lost you get!" The ship must have some internal security scanners. You've come this far. Might as well go all in.`
			choice
				`	(Drop your sidearm and proceed.)`
			label proceed
			branch orphan
				has "outfit (flagship installed): Midnight's Lost Orphan"
			scene "outfit/unknown"
			`	A door opens into a dimly lit room. After walking through, the door closes behind you. An empty table sits in the center and the lights brighten to reveal a strange masked figure wearing a cloak. With the same mechanical voice it says, "Welcome." The cloaked figure drops a Modified Blaster Pistol and three Blaster Chargers onto the table. "Charged one. Empty two. On yourself use empty, again can go. On me use empty, pass pistol. Hit with charged, lose. Go first, you."`
			choice
				`	(Pick up the pistol and load it.)`
					goto first
			label orphan
			scene "outfit/unknown"
			`	A door opens into a dimly lit room. After walking through, the door closes behind you. An empty table sits in the center and the lights brighten to reveal a strange masked figure wearing a cloak. With the same mechanical voice it says, "Welcome." The cloaked figure drops a Modified Blaster Pistol and three Blaster Chargers onto the table. "Charged one. Empty two. On yourself use empty, again can go. On me use empty, pass pistol. Hit with charged, lose. Go first, you." You notice Midnight's Lost Orphan observing from the side and get the impression it wants to feed on any feelings of hopelessness or despair you might experience during this encounter...`
			choice
				`	(Pick up the pistol and load it.)`
			label first
			scene "outfit/mod blaster pistol"
			`	All three blaster chargers look the same. You randomly choose one and load it into the pistol.`
			choice
				`	(Shoot the cloaked figure.)`
					goto shoot1of3
				`	(Shoot yourself.)`
					goto self1of3
			label self1of3
			branch death
				random < 33
			scene "outfit/mod blaster pistol"
			`	Nothing happens. You set aside the empty charger and look at the remaining two chargers. The cloaked figure speaks with its mechanical voice, "Carefully choose. One only is charged. Empty the other is." You load one and consider your next action.`
			choice
				`	(Shoot the cloaked figure.)`
					goto shoot1of2
				`	(Shoot yourself.)`
					goto self1of2
			label self1of2
			branch death
				random < 50
			scene "outfit/mod blaster pistol"
			`	Nothing happens. You set aside the empty charger and load it with the final charger.`
			label finalshot
			choice
				`	(Shoot the cloaked figure.)`
					goto kill
			label death
			scene "projectile/ionball"
			`	There is a bright flash of light followed by nothingness. "Unfortunate you are." The Puppetmaster takes your Blaster Charger from your corpse and adds it to the ones on the table.`
				die
			label shoot1of3
			branch kill
				random < 33
			scene "outfit/mod blaster pistol"
			`	Nothing happens. "Unfortunate you are. My turn it is now." Taking the pistol, the cloaked figure loads it and aims it at you before firing.`
			branch death
				random < 50
			scene "outfit/mod blaster pistol"
			`	Nothing happens. The cloaked figure passes the pistol to you. You set aside the empty charger and load it with the remaining charger.`
				goto finalshot
			label shoot1of2
			branch kill
				random < 50
			`	Nothing happens. "Unfortunate you are. My turn it is now." Taking the pistol, the cloaked figure loads it with the final charger and aims it at you before firing.`
			choice
				`	(Calmly accept your fate.)`
					goto death
				`	(Beg for mercy.)`
			`	The cloaked figure ignores your pitiful pleas and pulls the trigger.`
				goto death
			label kill
			action
				outfit "Modified Blaster Pistol" 1
				outfit "Blaster Charger" -1
				log "Minor People" "The Puppetmaster" `A strange hermit that can be found at the spaceport on Bailey. This person accepts challenges to a deadly game of Blaster Roulette. Those who succeed are rewarded with a Modified Blaster, but the Puppetmaster may be cheating somehow...`
			scene "outfit/mod blaster pistol"
			`	There is a bright flash of light. The cloaked figure is slammed back into the darkness. The door behind you opens and a mechanical voice from an unseen speaker says, "Congratulations. The Modified Blaster Pistol and chargers you may take." You return to the <ship> with your prize.`
				decline
			label fugitive
			`	The speaker crackles with static before going silent. Suddenly, the engines on the Puppetmaster's ship roar to life and the ship lifts off! This area of the spaceport is too far for you to return to your ship in time to go after it. Whoever is in there was spooked by your question regarding their relation to the Coalition...`
				decline

mission "Midnight Blaster Roulette 2"
	job
	repeat
	name "Blaster Charger"
	description "Used Blaster Charger for sale. May need some repair. Asking price is 10,000 credits. (You can challenge the Puppetmaster again with this.)"
	source Bailey
	to offer
		"credits" >= 20000
		has "Midnight Blaster Roulette 1: offered"
		has "outfit (flagship installed): Modified Blaster Pistol"
		random < 50
	on accept
		payment -10000
		conversation
			scene "outfit/blaster charger"
			`It wasn't cheap, but you should  be able to challenge the Puppetmaster again with this.`
			branch orphan
				has "outfit (flagship installed): Midnight's Lost Orphan"
			scene "outfit/unknown"
			`	After taking the effort to locate the Puppetmaster and going through the entry procedures, you once again find yourself in a dimly lit room with no weapons, staring at the same cloaked figure standing on the opposite side of an empty table. With a familiar mechanical voice it says, "Return you have." The cloaked figure drops a Modified Blaster Pistol and three Blaster Chargers onto the table. "Charged one. Empty two. On yourself use empty, again can go. On me use empty, pass pistol. Hit with charged, lose. Go first, you."`
			choice
				`	(Pick up the pistol and load it.)`
					goto first
			label orphan
			scene "outfit/unknown"
			`	Aftertaking the effort to locate the Puppetmaster and going through the entry procedures, you once again find yourself in a dimly lit room with no weapons, staring at the same cloaked figure standing on the opposite side of an empty table. With a familiar mechanical voice it says, "Return you have." The cloaked figure drops a Modified Blaster Pistol and three Blaster Chargers onto the table. "Charged one. Empty two. On yourself use empty, again can go. On me use empty, pass pistol. Hit with charged, lose. Go first, you." You notice Midnight's Lost Orphan observing from the side and get the impression it wants to feed on any feelings of hopelessness or despair you might experience during this encounter...`
			choice
				`	(Pick up the pistol and load it.)`
			label first
			scene "outfit/mod blaster pistol"
			`	All three blaster chargers look the same. You randomly choose one and load it into the pistol.`
			choice
				`	(Shoot the cloaked figure.)`
					goto shoot1of3
				`	(Shoot yourself.)`
					goto self1of3
			label self1of3
			branch death
				random < 33
			scene "outfit/mod blaster pistol"
			`	Nothing happens. You set aside the empty charger and look at the remaining two chargers. The cloaked figure speaks with its mechanical voice, "Carefully choose. One only is charged. Empty the other is." You load one and consider your next action.`
			choice
				`	(Shoot the cloaked figure.)`
					goto shoot1of2
				`	(Shoot yourself.)`
					goto self1of2
			label self1of2
			branch death
				random < 50
			scene "outfit/mod blaster pistol"
			`	Nothing happens. You set aside the empty charger and load it with the final charger.`
			label finalshot
			choice
				`	(Shoot the cloaked figure.)`
					goto kill
			label death
			scene "projectile/ionball"
			`	There is a bright flash of light followed by nothingness. "Unfortunate you are." The Puppetmaster takes your Blaster Charger from your corpse and adds it to the ones on the table.`
				die
			label shoot1of3
			branch kill
				random < 33
			scene "outfit/mod blaster pistol"
			`	Nothing happens. "Unfortunate you are. My turn it is now." Taking the pistol, the cloaked figure loads it and aims it at you before firing.`
			branch death
				random < 50
			scene "outfit/mod blaster pistol"
			`	Nothing happens. The cloaked figure passes the pistol to you. You set aside the empty charger and load it with the remaining charger.`
				goto finalshot
			label shoot1of2
			branch kill
				random < 50
			`	Nothing happens. "Unfortunate you are. My turn it is now." Taking the pistol, the cloaked figure loads it with the final charger and aims it at you before firing.`
			choice
				`	(Calmly accept your fate.)`
					goto death
				`	(Beg for mercy.)`
			`	The cloaked figure ignores your pitiful pleas and pulls the trigger.`
				goto death
			label kill
			action
				outfit "Modified Blaster Pistol" -1
				outfit "Dual Mod Blaster Pistols" 1
			scene "outfit/dual mod blaster pistols"
			`	There is a bright flash of light. The cloaked figure is slammed back into the darkness. The door behind you opens and a mechanical voice from an unseen speaker says, "Congratulations. The Modified Blaster Pistol and chargers you may take." With a second of these Modified Blaster Pistols, you can now dual wield them.`
				decline

mission "Midnight Blaster Roulette 3"
	job
	repeat
	name "Blaster Charger"
	description "Used Blaster Charger for sale. May need some repair. Asking price is 20,000 credits. (You can challenge the Puppetmaster again with this.)"
	source Bailey
	to offer
		"credits" >= 40000
		has "Midnight Blaster Roulette 2: offered"
		not "outfit (flagship installed): Modified Blaster Pistol"
		has "outfit (all): Dual Mod Blaster Pistols"
		random < 33
	on accept
		payment -20000
		conversation
			scene "outfit/blaster charger"
			`It wasn't cheap, but you should be able to challenge the Puppetmaster again with this.`
			branch orphan
				has "outfit (flagship installed): Midnight's Lost Orphan"
			`	After taking the effort to locate the Puppetmaster and going through the entry procedures, you once again find yourself in a dimly lit room with no weapons, staring at the same cloaked figure standing on the opposite side of an empty table. With a familiar mechanical voice it says, "Return you have." The cloaked figure drops a Modified Blaster Pistol and three Blaster Chargers onto the table. "Charged one. Empty two. On yourself use empty, again can go. On me use empty, pass pistol. Hit with charged, lose. Go first, you."`
			choice
				`	(Pick up the pistol and load it.)`
					goto first
			label orphan
			`	Aftertaking the effort to locate the Puppetmaster and going through the entry procedures, you once again find yourself in a dimly lit room with no weapons, staring at the same cloaked figure standing on the opposite side of an empty table. With a familiar mechanical voice it says, "Return you have." The cloaked figure drops a Modified Blaster Pistol and three Blaster Chargers onto the table. "Charged one. Empty two. On yourself use empty, again can go. On me use empty, pass pistol. Hit with charged, lose. Go first, you." You notice Midnight's Lost Orphan observing from the side and get the impression it wants to feed on any feelings of hopelessness or despair you might experience during this encounter...`
			choice
				`	(Pick up the pistol and load it.)`
			label first
			scene "outfit/mod blaster pistol"
			`	All three blaster chargers look the same. You randomly choose one and load it into the pistol.`
			choice
				`	(Shoot the cloaked figure.)`
					goto shoot1of3
				`	(Shoot yourself.)`
					goto self1of3
			label self1of3
			branch death
				random < 33
			scene "outfit/mod blaster pistol"
			`	Nothing happens. You set aside the empty charger and look at the remaining two chargers. The cloaked figure speaks with its mechanical voice, "Carefully choose. One only is charged. Empty the other is." You load one and consider your next action.`
			choice
				`	(Shoot the cloaked figure.)`
					goto shoot1of2
				`	(Shoot yourself.)`
					goto self1of2
			label self1of2
			branch death
				random < 50
			scene "outfit/mod blaster pistol"
			`	Nothing happens. You set aside the empty charger and load it with the final charger.`
			label finalshot
			choice
				`	(Shoot the cloaked figure.)`
					goto kill
			label death
			action
				clear "blaster roulette doubled"
			scene "projectile/ionball"
			`	There is a bright flash of light followed by nothingness. "Unfortunate you are." The Puppetmaster takes your Blaster Charger from your corpse and adds it to the ones on the table.`
				die
			label shoot1of3
			branch kill
				random < 33
			scene "outfit/mod blaster pistol"
			`	Nothing happens. "Unfortunate you are. My turn it is now." Taking the pistol, the cloaked figure loads it and aims it at you before firing.`
			branch death
				random < 50
			scene "outfit/mod blaster pistol"
			`	Nothing happens. The cloaked figure passes the pistol to you. You set aside the empty charger and load it with the remaining charger.`
				goto finalshot
			label shoot1of2
			branch kill
				random < 50
			`	Nothing happens. "Unfortunate you are. My turn it is now." Taking the pistol, the cloaked figure loads it with the final charger and aims it at you before firing.`
			choice
				`	(Calmly accept your fate.)`
					goto death
				`	(Beg for mercy.)`
			`	The cloaked figure ignores your pitiful pleas and pulls the trigger.`
				goto death
			label kill
			branch doubled
				has "blaster roulette doubled"
			scene "outfit/attention"
			`	There is a bright flash of light. The cloaked figure is slammed back into the darkness. The door behind you opens and a mechanical voice from an unseen speaker says, "Congratulations..." Suddenly, the cloaked figure rises back to the opposite side of the table! "Or Double or Nothing would you dare to take?"`
			choice
				`	"Okay, I'll go for double or nothing."`
					goto double
				`	"No, I've had enough."`
			action
				outfit "Modified Blaster Pistol" 1
			`	The mechanical voice answers, "The Modified Blaster Pistol and chargers you may take." You return to the <ship> with your prize.`
				decline
			label double
			action
				set "blaster roulette doubled"
			`	The door behind you slides shut. The cloaked figure places three fresh chargers on the table. "Charged one. Empty two. On yourself use empty, again can go. On me use empty, pass pistol. Hit with charged, lose. Go first, you."`
				goto first
			label doubled
			action
				clear "blaster roulette doubled"
				outfit "Dual Mod Blaster Pistols" 1
			scene "outfit/dual mod blaster pistols"
			`	There is a bright flash of light. The cloaked figure is slammed back into the darkness. The door behind you opens and a mechanical voice from an unseen speaker says, "Congratulations. These Modified Blaster Pistols and chargers you may take." The cloaked figure returns to the table with a second Modified Blaster Pistol. You return to the <ship> with your prize.`
				decline



mission "Midnight Vlad De Drakul"
	name "Vlad De Drakul"
	description "Discreetly transport Vlad De Drakul to <destination>. Payment will be <payment>. If you are caught with him, you may be fined."
	minor
	infiltrating
	source
		attributes "frontier" "dirt belt" "rim" "north" "south" "core" "paradise"
	destination Earth
	cargo coffin 1
	illegal 400000 `Your passenger turns out to be a notorious serial killer. As he is hauled off in chains, you vehemently protest that you knew nothing of his shady history. You wind up quite a bit poorer through a combination of fines and bribes (the breakdown remains somewhat unclear).`
	stealth
	to offer
		random < 70
		"getaway driver" > 5
		"rejected illegal jobs" < 3
		has "Shady passenger transport 2: done"
		month == 10
		not "Midnight Vlad De Drakul: failed"
	on offer
		conversation
			scene "outfit/coffin"
			branch returns
				has "vlad de drakul returns"
			`It's late at night when you find an odd man wearing strangely outdated and unfashionable clothing waiting at your ship's landing pad with a coffin. He greets you warmly and says he's willing to pay <payment> for passage to <destination> as quickly and discreetly as possible. He introduces himself as Vlad De Drakul and explains that he is making his annual pilgrimage to his ancestral home.  Something doesn't seem right about him, but he's offering a small fortune...`
			choice
				`	(Accept his offer.)`
				`	(Reject his offer.)`
					decline
			`	When you offer to show him to his bunk, he declines, saying that he will sleep in his coffin...`
				accept
			label returns
			`It's late at night when you find Vlad De Drakul waiting once again at your ship's landing pad with his coffin. He greets you warmly and says he's willing to pay <payment> to make his annual pilgrimage to <destination>.`
			choice
				`	(Accept his offer.)`
				`	(Reject his offer.)`
					decline
			`	When you offer to show him to his bunk, he declines, saying that he will sleep in his coffin...`
				accept
	on accept
		"rejected illegal jobs" --

	on decline
		"rejected illegal jobs" ++
	on fail
		outfit "Fake Coffin" 1
		log "Minor People" "Vlad De Drakul" `A strange client who always insisted on staying in his coffin instead of accepting a regular bunk...`
		conversation
			scene "outfit/coffin"
			"Vlad De Drakul is gone, but he left his coffin behind..."

	on visit
		dialog phrase "generic passenger on visit"
	on complete
		set "vlad de drakul returns"
		"getaway driver" ++
		payment 350000
		clear "Midnight Vlad De Drakul Reset: offered"
		dialog `You land under a moonlit sky. Vlad De Drakul has spoken hardly a word during the entire trip, seemingly spending the entire journey in his coffin. As soon as you land, he hands you your payment of <payment> and disappears into the night.`

mission "Midnight Vlad De Drakul Reset"
	landing
	invisible
	to offer
		has "Midnight Vlad De Drakul: offered"
		not "Midnight Vlad De Drakul: failed"
		month != 10
	on offer
		clear "Midnight Vlad De Drakul: offered"
		fail



mission "Mining: Claim Jumpers"
	minor
	invisible
	deadline 4
	repeat
	source
		government "Republic" "Syndicate" "Free Worlds"
	to offer
		"mining jobs done" >= 1
		random < 5
		has "flagship attribute: asteroid scan power"
	on offer
#		require "Asteroid Scanner"
		"reputation: Bounty (Disguised)" >?= 0
	npc
		government "Bounty (Disguised)"
		personality launching mining harvests timid
		fleet
			names "pirate"
			cargo 0
			variant 6
				"Scrounger (Tractor)" 3
			variant 3
				"Sparrow (Kludge Blaster)" 3
			variant 3
				"Modified Berserker (Kludge Blaster)" 3
			variant 3
				"Rancor (Kludge Blaster)" 3
			variant 3
				"Wasp (Kludge Blaster)" 3
			variant 3
				"Fury (Kludge Blaster)" 3
			variant 3
				"Stingray (Miner)" 3
			variant 1
				"Fury (Miner A)" 3
			variant 1
				"Fury (Miner B)" 3
			variant 1
				"Hawk (Miner A)"
			variant 1
				"Hawk (Miner B)"
			variant 1
				"Sparrow (Miner)"
			variant 1
				"Star Barge (Miner)"
		on kill
			"reputation: Bounty (Disguised)" >?= 0
	on fail
		"reputation: Bounty (Disguised)" >?= 0
	on complete
		"reputation: Bounty (Disguised)" >?= 0

mission "Mining: Iron Challenge"
	deadline 7
	minor
	repeat
	name "Iron Challenge"
	description "The captain of the <npc> has challenged you to a mining duel! Harvest 15 tons of Iron and return to <destination> by <date>. Whoever loses the duel gives their harvest to the winner."
	source
		planet Hestia Helheim Icefall Canyon Memory Calda Vail Vinci Hermes Earth Luna Mars Foundry Burthen Hephaestus Maker Oblivion "New Portland" Glaze Sundrinker Humanika "New India" Poisonwood Lichen
	to offer
		not "ships: Transport"
		not "ships: Light Warship"
		not "ships: Medium Warship"
		not "ships: Heavy Warship"
		not "ships: Utility"
		not "ships: Space Liner"
		not "ships: Light Freighter"
		not "ships: Heavy Freighter"
		not "ships: Superheavy" 
		"ships: Interceptor" == 1
		"flagship attribute: cargo" >= 15000
		random < 10 ( "iron challenge declined" * 10 )
	on offer
		conversation
			`Another pilot approaches you. "Nice ship. Are you a miner?`
			choice
				`	"I've harvested a few asteroids."`
				`	"I don't mine."`
					decline
			scene "asteroid/iron/spin"
			`	"How about a challenge then? It'll be my ship, the <npc>, versus yours. Whoever mines the most Iron by <date> wins. The loser gives their harvest to the winner. How about it?" The <npc> looks like a capable mining ship. But unless its been significantly modified, its pilot seems to have forgotten an important detail..."`
			choice
				`	(Accept the challenge.)`
				`	(Reject the challenge.)`
					decline
			`	"That's the spirit! We meet back here by <date>!"`
				accept
	on decline
		set "iron challenge declined"
	on enter
		conversation
			scene "asteroid/iron/spin"
			`There's Iron in this system. The pilot of the <npc> probably makes this type of challenge regularly. Time to find out who's the better miner!`
	npc accompany save
		government "Merchant"
		personality target mining harvests marked
		fleet
			names "civilian"
			cargo 0
			variant 1
				"Berserker (Kludge Blaster)"
			variant 1
				"Berserker (Energy Cannons)"
			variant 1
				"Wasp (Kludge Blaster)"
			variant 1
				"Wasp (Miner)"

	on complete
		"mining jobs done" ++
		outfit "Iron" -15
		payment 30000
		conversation
			scene "asteroid/iron/spin"
			`As expected, after tallying up who mined more Iron, it's obvious you've won. It seems the other pilot didn't realize your ship had more cargo space than the <npc>. He begrudgingly hands over his harvest. You end up selling both harvests for <payment>.`



mission "Rogue Asteroid (Pirate)"
	deadline 2
	minor
	name "Rogue Asteroid"
	description "A rogue asteroid may collide with <destination>. Destroy it to claim the reward (<payment>)."
	"apparent payment" 10000
	source
		government "Republic" "Syndicate" "Free Worlds" "Independent" "Neutral"
		attributes "frontier" "dirt belt"
		not attributes "uninhabited"
	to offer
		"combat rating" > 100
		or
			has "Rogue Asteroid (Rich World): done"
			has "Rogue Asteroid (Rich World): declined"
			has "Rogue Asteroid (Rich World): failed"
			has "Rogue Asteroid (Rich World): aborted"
		random < 5
	on offer
		conversation
			`The spaceport is a flurry of activity as pilots rush to prepare their ships for liftoff.`
			choice
				`	"Are we under attack from pirates?"`
				`	"Are we under attack from aliens?"`
			scene "asteroid/fossil/spin"
			`	One of the dockworkers answers, "A rogue asteroid has shifted into an erratic orbital path. The local government is offering pilots a <payment> reward for destroying it before it becomes a threat to <planet>."`
			choice
				`	(Try to destroy the asteroid.)`
					launch
				`	(Don't try to destroy the asteroid.)`
					decline
	npc kill
		government "Bounty"
		personality target uninterested forbearing waiting staying
		fleet
			names "asteroid names"
			cargo 0
			variant
				"Mysterious Asteroid"
				"Dagger" 5
		dialog `The government of <planet> rewards you with <payment> for destroying the asteroid threat.`
		on kill
			"mining jobs done" ++
			payment 10000
			fail

mission "Rogue Asteroid (Rich World)"
	deadline 2
	minor
	name "Rogue Asteroid"
	description "A rogue asteroid may collide with <destination>. Destroy it to claim the reward (<payment>)."
	"apparent payment" 10000
	source
		government "Republic" "Syndicate" "Free Worlds" "Independent" "Neutral"
		attributes "paradise" "urban" "rich" "tourist"
		not attributes "uninhabited"
	to offer
		"combat rating" > 100
		random < 10
	on offer
		conversation
			`The spaceport is a flurry of activity as pilots rush to prepare their ships for liftoff.`
			choice
				`	"Are we under attack from pirates?"`
				`	"Are we under attack from aliens?"`
			scene "asteroid/fossil/spin"
			`	One of the dockworkers answers, "A rogue asteroid has shifted into an erratic orbital path. The local government is offering pilots a <payment> reward for destroying it before it becomes a threat to <planet>."`
			choice
				`	(Try to destroy the asteroid.)`
					launch
				`	(Don't try to destroy the asteroid.)`
					decline
	npc kill
		government "Bounty"
		personality target uninterested waiting staying mute
		fleet
			names "asteroid names"
			cargo 3
			outfitters "Iron" "Lead" "Silicon"
			variant
				"Rogue Asteroid"
		dialog `The government of <planet> rewards you with <payment> for destroying the asteroid threat.`
		on kill
			"mining jobs done" ++
			payment 20000
			fail

mission "Rogue Asteroid (Ambush)"
	landing
	invisible
	source
		attributes "pirate" "frontier"
	to offer
		or
			has "Rogue Asteroid (Pirate): done"
			has "Rogue Asteroid (Pirate): declined"
			has "Rogue Asteroid (Pirate): failed"
			has "Rogue Asteroid (Pirate): aborted"
		random < 1
	npc kill
		government "Pirate"
		personality uninterested forbearing waiting staying mute
		fleet
			names "pirate"
			cargo 3
			outfitters "Iron" "Lead" "Silicon"
			variant 1
				"Mysterious Asteroid"
				"Dagger" 5
			variant 1
				"Mysterious Asteroid"
				"Dagger" 4
		on kill
			clear "Rogue Asteroid (Ambush): offered"
			fail


phrase "blackwing scan request"
	word
		`A mangy old `
		`A young hotshot `
		`A seasoned `
	word
		`pirate `
		`bucanneer `
		`rogue `
		`mercenary `
		`smuggler `
		`information broker `
	word
		`with a cautious expression `
		`with a curious expression `
		`with a cybernetic arm `
		`with a prosthetic leg `
		`with more brains than brawn `
		`wearing an eye patch `
		`wearing a scruffy bandanna `
		`wearing a mask `
		`wearing an old pilot suit `
		`wearing a tattered cloak `
		`wearing thick goggles `
		`carrying an old knapsack `
		`carrying a data pad `
	word
		`approaches you. "Are you familiar with the Blackwings? One is about to launch and I'll pay you 50,000 credits if you can get me a scan of their outfits."`

mission "Blackwing Scan Request"
	repeat
	deadline 1
	minor
	name "Blackwing Scan Request"
	description "Scan the <npc> before it leaves the system, then bring the data to <destination>. Payment is 50,000 credits."
	source
		attributes "dirt belt" "frontier"
	to offer
		or
			and
				"credits" < 500000
				random < 15
			and
				"credits" >= 500000
				"credits" < 1000000
				random < 10
			and
				"credits" >= 1000000
				"credits" < 10000000
				random < 5
			and
				"credits" >= 10000000
				random < 1
	on offer
		dialog phrase "blackwing scan request"
	npc "scan outfits"
		government "Independent"
		personality target timid lingering uninterested surveillance secretive mute
		ship "Modified Blackbird" "Black Wings"
		dialog `You did your best to scan the <npc>. Return to <origin> with the scanner data for your reward.`
	on complete
		payment 25000
		dialog `They're not happy with the scanner data of the <npc> and only pay half of the reward...`



mission "Lares Camping (Bums)"
	minor
	invisible
	source "Lares"
	to offer
		random < "day"
	on offer
		conversation
			`Despte being abandoned, the nearby cabins are well furnished. It might be a nice change of pace to sleep somewhere other than the cramped bunk on your ship.`
			choice
				`	(Camp here for the night.)`
				`	(Head back to your ship.)`
					defer
			`	Archipelago nights can be bright as twilight, depending on the positioning of the nearby star systems. Looking out the window, you see some wild animals moving among the trees.`
			choice
				`	(Go hunting.)`
				`	(Stay indoors.)`
					goto morning
			`	You grab your gun and head out into the woods. Not too far is some kind of three legged furry creature. You take aim and fire! The creature collapses while other animals farther away flee. Hauling the carcass back to the cabin isn't difficult and you start skinning the creature. You're just about done when there's a knock on your door.`
			choice
				`	(Answer.)`
				`	(Ignore.)`
					goto alone
			`	You open the door and find a pair of hobos who were attracted by the gunfire. They're hoping you'd be willing to spare some of whatever you caught.`
			choice
				`	(Share.)`
				`	(Refuse.)`
					goto bumfight
			`	You give each hobo one of the creature's legs. They are overjoyed at the gift and thank you before leaving. You watch them head over to one of the other abandoned cabins.`
				goto alone
			
			label bumfight
			branch "lucky"
				random < 33
			`	It's two against one and it turns out these bums have guns of their own! You manage to shoot one, but the other one shoots you. The bullet lands somewhere inside a vital organ.`
				die
			label "lucky"
			`	It's two against one and it turns out these bums have guns of their own! Fortunately, their shots miss and you manage to take them down. With all the gunfire, you've no doubt that more unwelcome guests will be approaching. Better head back to your ship and get out of here.`
				depart
			
			label alone
			`	You light up the fireplace and roast the meat from the creature you hunted. The smell of the charred meat is heavenly and you can't resist taking a bite of the delicious barbecue as its juices glisten in the firelight. It's always great to have fresh food instead of the usual canned slop you keep in your ship's pantry.`
			
			label morning
			`	After a restful night, you clean up the cabin and head back to your ship.`
				decline

mission "Lares Camping (Raiders)"
	minor
	invisible
	source "Lares"
	to offer
		random < 50
	on offer
		conversation
			`Despite being abandoned, the nearby cabins are well furnished. It might be a nice change of pace to sleep somewhere other than the cramped bunk on your ship.`
			choice
				`	(Camp here for the night.)`
				`	(Head back to your ship.)`
					defer
			`You settle in for a peaceful night's sleep when the silence is broken by the sounds of an afterburner ripping through the night sky! That sound is quickly overttaken by a loud explosion from the direction of the spaceport!`
			choice
				`	(Stay here.)`
				`	(Head back to your ship.)`
					goto raiders
			`	You kill the lights and huddle with your gun in the darkness. There are distant sounds of yelling and gunfire. Eventually, the sounds fade and silence reclaims the night.`
			choice
				`	(Stay here.)`
				`	(Head back to your ship.)`
					goto raiders
			`	You try to get some sleep, but you keep your gun clutched close in case someone comes looking for trouble. Eventually, morning comes.`
			label raiders
			`	When you get back to the spaceport, you find the burnt wreck of a pirate interceptor near your ship. It looks like someone tried and failed to pry open the hatch to your ship. There are no other ships nearby and other than the addition of the wrecked interceptor, the spaceport looks as deserted as usual.`
				decline
	on decline
		event "Lares Midnight Crash"

event "Lares Midnight Crash"
	planet Lares
		spaceport `The spaceport is a concrete slab forming a large forest clearing surrounded by some log cabins. The burnt wreckage of a pirate interceptor sits on the edge of the slab. You see no other parked ships and the area looks deserted.`

mission "Lares Camping (Scavenger)"
	minor
	invisible
	source "Lares"
	to offer
		random < 30 - "day"
	on offer
		conversation
			`Despte being abandoned, the nearby cabins are well furnished. It might be a nice change of pace to sleep somewhere other than the cramped bunk on your ship.`
			choice
				`	(Camp here for the night.)`
				`	(Head back to your ship.)`
					defer
			`	The night is surprisingly dark and a cool breeze blows in the window. As you close the shutters, you hear a scratching sound on your door.`
			choice
				`	(Answer.)`
				`	(Ignore.)`
					goto morning
			`	You've barely opened the door a crack when a small furball darts in underfoot! The cabin is riddled with innumerable nooks and crannies between and under the furnishings. There's no telling where the creature went. All night long you hear weird scratching sounds as the creature scampers about unseen. Before you can get any shuteye, the first light of dawn is already filtering in between the window shutters. To your dismay, you discover that the creature managed to get into your food stash, leaving crumbs scattered about. You tidy up the cabin as best as you can, but are unable to find the little creature responsible for your sleepless night of misery. You are still bleary eyed when you return to your ship and idly wonder if you should really be piloting it in your current condition.`
				decline
			label morning
			`	After a restful night, you clean up the cabin and head back to your ship.`
				decline

mission "Lares Exploring"
	minor
	repeat
	source "Lares"
	to offer
		or
			and
				not "Lares Exploring: failed"
				random < 15
			and
				has "Lares Exploring: failed"
				random < 10
	on offer
		conversation
			`It's a beautiful day for a hike...`
			choice
				`	(Explore the wilderness.)`
				`	(Not now...)`
					defer
			branch "cave"
				random < 50

			branch "lake"
				random < 50

			`During your hike you spot several new types of animals you've never seen before. Eventually, you find a forest clearing.`
			choice
				`	(Stop for a picnic.)`
				`	(Return to your ship.)`
					defer
			`	While eating lunch, you notice something weird about the ground nearby.`
			choice
				`	(Dig it up.)`
				`	(Ignore it and return to your ship.)`
					defer
			branch "predator"
				random < 20
			
			branch "weapons"
				random < 50
			
			branch "treasure"
				random < 20

			scene "scene/scene-empty box"
			`	You find an old empty crate. From the way the wood is rotted, it must have been here for a very long time.`
				defer

			label "treasure"
			action
				outfit "Mysterious Treasure" 1
			scene "outfit/treasure"
			`	You find an old crate. Inside is a Mysterious Treasure! You could probably sell it for a decent sum anywhere, but getting it appraised by someone knowledgeable about archaeology might yield better results.`
				decline
			
			label "weapons"
			action
				outfit "Sniper Rifle" 1
				outfit "Fragmentation Grenades" 1
				outfit "Bullet Boxes" 1
				outfit "Gatling Gun Ammo" 1500
			scene "scene/scene-weapons cache"
			`	You find an old weapons cache. These look ancient, but probably still work.`
				decline
			
			label "predator"
			scene "outfit/mouthparts"
			`	Suddenly you are attacked by a vicious predator!`
			choice
				`	(Run back to your ship!)`
					defer
				`	(Kill the beast!)`

			branch "death"
				random < 20
			scene "outfit/laser rifle"
			`	Fortunately, you happen to be armed and have no trouble putting down the creature. At least tonight's dinner is covered!`
				defer
			
			label "death"
			scene "scene/scene-devoured"
			`	Before you can properly aim, the beast has taken your arm! The pain and shock renders you unable to escape as the beast devours you alive...`
				die
			
			label lake
			`During your hike you spot several new types of animals you've never seen before. Eventually, you find a lake.`
			choice
				`	(Go for a swim.)`
				`	(Return to your ship.)`
					defer
			branch "predator"
				random < 33
			
			`	While swimming you notice an unnatural object beneath the water.`
			choice
				`	(Bring it back to the surface.)`
				`	(Ignore it and return to your ship.)`
					defer
			branch "predator"
				random < 50

			branch "weapons"
				random < 50
			
			branch "treasure"
				random < 20

			scene "scene/scene-empty box"
			`	You find an old empty crate. From the way the wood is rotted, it must have been here for a very long time.`
				defer
			
			label cave
			`During your hike you spot several new types of animals you've never seen before. Eventually, you find a cave.`
			choice
				`	(Search the cave.)`
				`	(Ignore it and return to your ship.)`
					defer
			branch "predator"
				random < 25

			branch "empty"
				random < 50
			
			branch "weapons"
				random < 50
			
			branch "treasure"
				random < 20

			scene "scene/scene-empty box"
			`	You find an old empty crate. From the way the wood is rotted, it must have been here for a very long time.`
				defer

			label "empty"
			`	The cavern is empty. Perhaps you are the first human to set eyes on these rock formations.`
				defer



mission "Pirate Raid: Shield Suppressor"
	landing
	invisible
	deadline 3
	repeat
	source
		government "Republic" "Syndicate" "Free Worlds" "Pirate" "Neutral" "Independent"
	to offer
		has "outfit (installed): Shield Suppressor"
		"reputation: Pirate" < 0
		"combat rating" >= 403
		random < 10
	npc
		government "Pirate"
		personality nemesis harvests plunders entering
		fleet "pirate raid" 2
	npc evade
		to spawn
			"combat rating" > 1097
		government "Pirate"
		personality nemesis harvests plunders entering
		fleet "pirate raid" 2
		fleet "Marauder fleet I"
	npc evade
		to spawn
			"combat rating" > 2981
		government "Pirate"
		personality nemesis harvests plunders entering
		fleet "pirate raid" 2
		fleet "Marauder fleet II"
	npc evade
		to spawn
			"combat rating" > 8103
		government "Pirate"
		personality nemesis harvests plunders entering
		fleet "Marauder fleet VII"
		fleet "Marauder fleet III"
	npc evade
		to spawn
			"combat rating" > 22026
		government "Pirate"
		personality nemesis harvests plunders entering
		fleet "Marauder fleet VIII"
		fleet "Marauder fleet IV"
	npc evade
		to spawn
			"combat rating" > 59874
		government "Pirate"
		personality nemesis harvests plunders entering
		fleet "Marauder fleet IX"
		fleet "Marauder fleet V"
	npc evade
		to spawn
			"combat rating" > 162755
		government "Pirate"
		personality nemesis harvests plunders entering
		fleet "Marauder fleet X"
		fleet "Marauder fleet VI"
	npc evade
		to spawn
			"combat rating" > 442413
		government "Pirate"
		personality nemesis harvests plunders entering
		fleet "Large Southern Pirates"
		fleet "Large Core Pirates"
		fleet "Large Northern Pirates"



##################################
#
# deprecated missions
#
##################################

mission "Rogue Asteroid (Poor World)"
	deadline 2
	minor
	name "Rogue Asteroid"
	description "A rogue asteroid may collide with <destination>. Destroy it, then land on <planet> to claim the reward (<payment>)."
	source
		government "Republic" "Syndicate" "Free Worlds" "Independent" "Neutral"
		not attributes "paradise" "urban" "rich" "tourist"
		not attributes "uninhabited"
	to offer
		never
	on offer
		conversation
			`The spaceport is a flurry of activity as pilots rush to prepare their ships for liftoff.`
			choice
				`	"Are we under attack from pirates?"`
				`	"Are we under attack from aliens?"`
			scene "asteroid/fossil/spin"
			`	One of the dockworkers answers, "A rogue asteroid has shifted into an erratic orbital path. The local government is offering pilots a <payment> reward for destroying it before it becomes a threat to <planet>."`
			choice
				`	(Try to destroy the asteroid.)`
					launch
				`	(Don't try to destroy the asteroid.)`
					decline
	npc kill
		government "Bounty"
		personality target uninterested waiting staying mute
		fleet
			names "asteroid names"
			cargo 3
			outfitters "Copper" "Gold" "Silver"
			variant
				"Rogue Asteroid"
		dialog `You've destroyed the rogue asteroid. Return to <planet> for your reward.`

	on complete
		payment 10000
		dialog `The government of <planet> rewards you with <payment> for destroying the asteroid threat.`

mission "Sabotage: Shield Suppressor (assisting)"
	assisting
	invisible
	minor
#	repeat
	deadline 1
	source
		government "Merchant" "Pirate" "Independent" "Independent (Killable)" "Bounty (Disguised)"
		not attributes "automaton"
	destination "Earth"
	to offer
		never
#		"combat rating" >= 1097
#		has "Sabotage: Shield Suppressor (boarding): offered"
#		random < 1
	on offer
		outfit "Shield Suppressor" 1
		conversation "sabotage: shield suppressor"
	npc kill
		government "Bounty Hunter"
		personality nemesis entering heroic
		fleet "Bounty Hunters" 2
